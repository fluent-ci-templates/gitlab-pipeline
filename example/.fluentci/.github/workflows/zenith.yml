# Do not edit this file directly. It is generated by https://deno.land/x/fluent_github_actions

name: Zenith Example
on:
  push:
    branches:
      - zenith

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Dagger Zenith
        run: |
          curl -L https://dl.fluentci.io/zenith/dagger -o dagger
          curl -L https://dl.fluentci.io/zenith/engine.tar -o engine.tar
          chmod +x dagger
          sudo mv dagger /usr/local/bin
          dagger version
          docker load -i engine.tar
          export SHA256_HASH=$(docker images --no-trunc | awk '{if ($2 == "<none>") print $3}' | head -n 1)
          docker tag $SHA256_HASH localhost/dagger-engine.dev
          docker images
          docker volume create dagger-engine.dev
          docker run -d -e _EXPERIMENTAL_DAGGER_CACHE_CONFIG -e _EXPERIMENTAL_DAGGER_SERVICES_DNS -e _EXPERIMENTAL_DAGGER_CLOUD_TOKEN -e _EXPERIMENTAL_DAGGER_CLOUD_URL -v dagger-engine.dev:/var/lib/dagger --name dagger-engine.dev --privileged localhost/dagger-engine.dev --debug
          docker ps
      - name: Run Dagger Pipelines
        run: |
          dagger query --doc hello.gql
        working-directory: example
        env:
          _EXPERIMENTAL_DAGGER_CLI_BIN: /usr/local/bin/dagger
          _EXPERIMENTAL_DAGGER_RUNNER_HOST: docker-container://dagger-engine.dev
